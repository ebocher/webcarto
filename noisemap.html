<!DOCTYPE html>
<html>
    <head>
        <title>Cartographie du bruit à Nantes</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="description" content="Cartes de bruit sur la ville de Nantes ">
        <meta name="author" content="Erwan Bocher">


        <link rel="stylesheet" href="js/leaflet/core/leaflet.css" />
        <!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.4/leaflet.ie.css" /><![endif]-->

        <script src="js/leaflet/core/leaflet.js"></script>
        <script src="js/jquery/jquery.min.js"></script>

        <!--Plugin geosearch-->
        <script src="js/leaflet/geosearch/js/l.control.geosearch.js"></script>
        <script src="js/leaflet/geosearch/js/l.geosearch.provider.openstreetmap.js"></script>
        <link rel="stylesheet" href="js/leaflet/geosearch/css/l.geosearch.css" />	


        <!--Plugin groupedlayer-->
        <script src="js/leaflet/groupedlayercontrol/js/leaflet.groupedlayercontrol.js"></script>
        <link rel="stylesheet" href="js/leaflet/groupedlayercontrol/css/leaflet.groupedlayercontrol.css" />

        <!--Plugin mouse position-->
        <script src="js/leaflet/mouseposition/js/L.Control.MousePosition.js"></script>
        <link rel="stylesheet" href="js/leaflet/mouseposition/css/L.Control.MousePosition.css" />

        <!--Plugin zoom center-->
        <link rel="stylesheet" href="js/leaflet/viewcenter/leaflet.viewcenter.css" />
        <script src="js/leaflet/viewcenter/leaflet.viewcenter.js"></script>

        <!-- Include the loading control -->
        <link rel="stylesheet" href="js/leaflet/loading/Control.Loading.css" />
        <script src="js/leaflet/loading/Control.Loading.js"></script>

        <!-- include jQuery -->
        <script src="js/jquery/jquery.min.js"></script>

        <!-- Then just attach the Reveal plugin -->
        <script src="js/jquery/reveal/jquery.reveal.js" type="text/javascript"></script>
        <!-- Then just attach the Reveal plugin -->
        <link rel="stylesheet" href="js/jquery/reveal/reveal.css">



        <!-- Global CSS for the page -->
        <link rel="stylesheet" href="css/main.css">


    </head>
    <body>
        <div class="logo">
            <img src="images/cartopolis_4.png" />
            <h1>Modélisation de la cartographie du bruit à Nantes</h1>
        </div>
        <ul id="menuFilter">
            <li><a href="javascript:toggleDiv('legendBar');">Légende(s)</a></li>
            <li>
                <a href="#" data-reveal-id="about">A propos</a>
            </li>
            <li><a href="http://www.irstv.fr" target="_blank">En savoir plus</a></li>
        </ul>
        <!-- Ajout du cadre pour les legendes -->	
        <div id="legendBar">
        </div>

        <div id="map" style="position: absolute;  margin-top: 30px; left: 0; width: 100%; height: 85%;">
        </div>



        <script type="text/javascript">

            var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png';
            var basemap = new L.TileLayer(cloudmadeUrl, {maxZoom: 18});

            var map = new L.Map('map', {
                layers: [basemap],
                center: new L.LatLng(47.22, -1.54427), zoom: 12
            });

            //Create a custom group of layers
            var baseLayers = {
                "Fond de carte": basemap,
            };

            //Add some layers delivered with geoserver
            var noiseMap_bat_2008 = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:noise_level_bat_resid_2008_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'Noise_map_db_bat_resid_2008',
                version: '1.3.0',
                attribution: "Année de référence avec données d'enquêtes."
            });

            var noiseMap_bat_test1 = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:noise_level_bat_resid_2008_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'Noise_map_db_bat_resid_test_1',
                version: '1.3.0',
                attribution: "Baisse de la demande automobile de 25%. "
            });

            var noiseMap_bat_test2 = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:noise_level_bat_resid_2008_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'Noise_map_db_bat_resid_test_2',
                version: '1.3.0',
                attribution: "Augmentation de la demande globale de déplacement de 20%."
            });

            var noiseMap_bat_test4 = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:noise_level_bat_resid_2008_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'Noise_map_db_bat_resid_test_4',
                version: '1.3.0',
                attribution: "Multiplication par deux des prix du carburant"
            });


            map.addLayer(noiseMap_bat_2008);
           
            
            var iris_contour = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:iris2008_lden2008_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'polygon_vide',
                version: '1.3.0',
            });
            
            var iris_lden_2008 = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:iris2008_lden2008_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'Noise_map_db_pop_sup_68db',
                version: '1.3.0',
            });
            
            
             var iris_lden_test1 = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:iris2008_lden_test1_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'Noise_map_db_pop_sup_68db',
                version: '1.3.0',
            });
            
             var iris_lden_test2 = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:iris2008_lden_test2_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'Noise_map_db_pop_sup_68db',
                version: '1.3.0',
            });
            
            var iris_lden_test4 = L.tileLayer.wms("http://cartopolis.org/geoserver/IRSTV/wms", {
                layers: 'IRSTV:iris2008_lden_test4_nantes',
                format: 'image/png',
                transparent: true,
                styles: 'Noise_map_db_pop_sup_68db',
                version: '1.3.0',
            });
            
            

            map.addLayer(iris_contour);
            
            // LDEN pour les bâtiments
            var groupedLDENBat = {
                "LDEN max en dB(A) par bâtiments": {
                    "Situation de référence en 2008": noiseMap_bat_2008,
                    "Scénario test 1": noiseMap_bat_test1,
                    "Scénario test 2": noiseMap_bat_test2,
                    "Scénario test 4": noiseMap_bat_test4
                },
                "Exposition de la population (% d'habs > 68 dB(A))": {
                    "Contours IRIS en 2008": iris_contour,
                    "Situation de référence en 2008":iris_lden_2008,
                    "Scénario test 1" : iris_lden_test1,
                    "Scénario test 2" : iris_lden_test2,
                    "Scénario test 4" : iris_lden_test4,
                }
            };


            //Load the group layers plugin
            new L.control.groupedLayers(baseLayers, groupedLDENBat).addTo(map);

            //Load mouse position plugin
            new L.control.mousePosition().addTo(map);

            //Load the geosearch plugin
            new L.Control.GeoSearch({
                provider: new L.GeoSearch.Provider.OpenStreetMap()
            }).addTo(map);

            //Load the view center control
            var viewCenter = new L.Control.ViewCenter({title: 'Zoom sur la Ville de Nantes', vcLatLng: [47.22, -1.54427], vcZoom: 12});
            map.addControl(viewCenter);

            // Add our loading control in the same position and pass the
            // zoom control to attach to it
            var loadingControl = L.Control.loading({
                position: 'topright', separate: true
            });
            map.addControl(loadingControl);

                       
             //Create a legend for noise map
            legend1 = function() {
                var div = L.DomUtil.create('div', 'info legend'), labels = ["<h6>Nuisance sonore en dB(A)</h6>"];
                div.innerHTML = labels.join('');
                div.innerHTML += '<img src="http://www.cartopolis.org/geoserver/IRSTV/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=IRSTV:noise_level_bat_resid_2008_nantes" alt="legend" width="58" height="140">';
                return div;
            };

           //Create a legend for noise map
            legend2 = function() {
                var div = L.DomUtil.create('div', 'info legend'), labels = ["<h6>Pourcentage<br> d'habitants (> 68dB)</h6>"];
                div.innerHTML = labels.join('');
                div.innerHTML += '<img src="http://www.cartopolis.org/geoserver/IRSTV/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=IRSTV:iris2008_lden2008_nantes" alt="legend" width="66" height="120">';
                return div;
            };
            
            //Add the legends to the legend frame
            $("#legendBar").html(legend1);
            $("#legendBar").append(legend2);


        </script>

        <!-- Show hide the legend frame -->
        <script type="text/javascript">
            function toggleDiv(divId, divId1) {
                $("#" + divId).fadeToggle('slow');
            }
        </script>

        <div id="about" class="reveal-modal">
            <a href="http://www.cartopolis.org"><img src="images/cartopolis_logo.png" width="50" alt="CartoPOLIS" style="float: right; margin: 50px 0 0 20px;" /></a>
            <h2>A propos des cartes de bruit</h2>
            <p>Les resultats présentés dans ce navigateurs sont issus des travaux de l'ANR Eval-PDU.</p>
            <p>Ces resultats proviennent de simulations réalisées avec la plateforme OrbisGIS 
                par le Laboratoire d’acoustique environnementale de l'<a href="http://www.ifsttar.fr" target="blank" title="IFSTTAR"><u>IFSTTAR</u>.</a>. Les auteurs déclinent 
                toute responsabilité concernant l'interprétation qui pourrait en être faite.</p>
            <p>              
            <p>
                <strong>En savoir plus ?</strong> Visitez <a href="http://semfinalevalpdu.sciencesconf.org/" target="blank" title="Eval-PDU"><u>la page de synthèse du programme de recherche Eval-PDU</u>.</a></p>
            <a class="close-reveal-modal">×</a>
        </div>
        <div class="reveal-modal-bg"></div>


    </body>
</html>
