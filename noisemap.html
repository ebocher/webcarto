<!DOCTYPE html>
<html>
    <head>
        <title>Cartographie du bruit à Nantes</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="description" content="Cartes de bruit sur la ville de Nantes ">
        <meta name="author" content="Erwan Bocher">


        <link rel="stylesheet" href="js/leaflet/core/leaflet.css" />
        <!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.4/leaflet.ie.css" /><![endif]-->

        <script src="js/leaflet/core/leaflet.js"></script>
        <script src="js/jquery/jquery.min.js"></script>

        <!--Plugin geosearch-->
        <script src="js/leaflet/geosearch/js/l.control.geosearch.js"></script>
        <script src="js/leaflet/geosearch/js/l.geosearch.provider.openstreetmap.js"></script>
        <link rel="stylesheet" href="js/leaflet/geosearch/css/l.geosearch.css" />	


        <!--Plugin groupedlayer-->
        <script src="js/leaflet/groupedlayercontrol/js/leaflet.groupedlayercontrol.js"></script>
        <link rel="stylesheet" href="js/leaflet/groupedlayercontrol/css/leaflet.groupedlayercontrol.css" />

        <!--Plugin mouse position-->
        <script src="js/leaflet/mouseposition/js/L.Control.MousePosition.js"></script>
        <link rel="stylesheet" href="js/leaflet/mouseposition/css/L.Control.MousePosition.css" />

	<!--Plugin zoom center-->
	<link rel="stylesheet" href="js/leaflet/viewcenter/leaflet.viewcenter.css" />
	<script src="js/leaflet/viewcenter/leaflet.viewcenter.js"></script>

	<!-- Include the loading control -->
        <link rel="stylesheet" href="js/leaflet/loading/Control.Loading.css" />
        <script src="js/leaflet/loading/Control.Loading.js"></script>
        
         <!-- include jQuery -->
        <script src="js/jquery/jquery.min.js"></script>

        <!-- Then just attach the Reveal plugin -->
	<script src="js/jquery/reveal/jquery.reveal.js" type="text/javascript"></script>
        <!-- Then just attach the Reveal plugin -->
        <link rel="stylesheet" href="js/jquery/reveal/reveal.css">

	
        
        <!-- Global CSS for the page -->
        <link rel="stylesheet" href="css/main.css">


    </head>
    <body>
            <div class="logo">
                <img src="images/cartopolis_4.png" />
                <h1>Modélisation de la cartographie du bruit à Nantes</h1>
            </div>
            <ul id="menuFilter">
                <li><a href="javascript:toggleDiv('legendBar');">Légende(s)</a></li>
                <li>
			<a href="#" data-reveal-id="about">A propos</a>
                </li>
                <li><a href="http://www.irstv.fr" target="_blank">En savoir plus</a></li>
            </ul>
 		<!-- Ajout du cadre pour les legendes -->	
    		<div id="legendBar">
    		</div>

            <div id="map" style="position: absolute;  margin-top: 30px; left: 0; width: 100%; height: 100%;">
		</div>

        

        <script type="text/javascript">

            var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png';
            var basemap = new L.TileLayer(cloudmadeUrl, {maxZoom: 18});

            var map = new L.Map('map', {
                layers: [basemap],
                center: new L.LatLng(47.22, -1.54427), zoom: 12
            });

            //Add some layers delivered with OrbisGIS server
            var noiseMap = L.tileLayer.wms("http://services.orbisgis.org/wms/wms", {
                layers: 'bat_resid_2008_nantes_noiseLevel',
                format: 'image/png',
                transparent: true,
                styles: 'bat_resid_2008_nantes_noiseLevel',
                version: '1.3.0',
                attribution: "LDEN max en dB(A) par bâtiments"
            });



            var iris_contour = L.tileLayer.wms("http://services.orbisgis.org/wms/wms", {
                layers: 'iris2008_lden_greaterthan68',
                format: 'image/png',
                transparent: true,
                styles: 'iris_contour',
                version: '1.3.0',
                attribution: "Contour IRIS 2008"
            });

            var iris_2008_max68 = L.tileLayer.wms("http://services.orbisgis.org/wms/wms", {
                layers: 'iris2008_lden_greaterthan68',
                format: 'image/png',
                transparent: true,
                styles: 'iris_ldengreaterthan68_2008_categorize',
                version: '1.3.0',
                attribution: "LDEN superieur à 68 dB(A) en 2008"
            });


            map.addLayer(noiseMap);
            map.addLayer(iris_contour);

            //Create a custom group of layers
            var baseLayers = {
                "Fond de carte": basemap
            };

            //Results from ANR EvalPDU
            var evalpdu = new L.LayerGroup();
            evalpdu.addLayer(iris_2008_max68);

            // Overlay layers are grouped
            var groupedOverlays = {
                "Noise maps": {
                    "Contour IRIS": iris_contour,
                    "Scenarios": evalpdu,
                    "LDEN par bâtiments": noiseMap
                }
            };


            //Load the group layers plugin
            new L.control.groupedLayers(baseLayers, groupedOverlays).addTo(map);

            //Load mouse position plugin
            new L.control.mousePosition().addTo(map);

            //Load the geosearch plugin
            new L.Control.GeoSearch({
                provider: new L.GeoSearch.Provider.OpenStreetMap()
            }).addTo(map);

		//Load the view center control
		var viewCenter = new L.Control.ViewCenter({title: 'Zoom sur la Ville de Nantes', vcLatLng: [47.22, -1.54427], vcZoom: 12});
		map.addControl(viewCenter);

	// Add our loading control in the same position and pass the
                // zoom control to attach to it
                var loadingControl = L.Control.loading({
                    position: 'topright', separate:true
                });
                map.addControl(loadingControl);

	//Create a legend for noise map
        legend1 = function() {
            var div = L.DomUtil.create('div', 'info legend'),
                    labels = ['<h6>Nuisance sonore en dB</h6>',
                '<i style="background:#4CC800"></i><45<br>',
                '<br><i style="background:#55FF00"></i>45-50<br>',
                '<br><i style="background:#B9FF73"></i>50-55<br>',
                '<br><i style="background:#FFFF00"></i>55-60<br>',
                '<br><i style="background:#FFAA00"></i>60-65<br>',
                '<br><i style="background:#FF0000"></i>65-70<br>',
                '<br><i style="background:#D500FF"></i>70-75<br>',
                '<br><i style="background:#960064"></i>>75<br>'];
            div.innerHTML = labels.join('');
            return div;
        };

        //Create the second legend for population map	
        legend2 = function() {
            var div = L.DomUtil.create('div', 'info legend'),
                    labels = ["<h6>Pourcentage<br> d'habitants (> 68dB)</h6>",
                '<br><i style="background:#F7F4F9"></i><5<br>',
                '<br><i style="background:#D4B9DA"></i>5-10<br>',
                '<br><i style="background:#C994C7"></i>10-20<br>',
                '<br><i style="background:#E7298A"></i>20-30<br>',
                '<br><i style="background:#CE1256"></i>30-50<br>',
                '<br><i style="background:#67001F"></i>>50<br>'];
            div.innerHTML = labels.join('');
            return div;
        };
        //Add the legends to the legend frame
        $("#legendBar").html(legend1);
        $("#legendBar").append(legend2);

	
        </script>

	<!-- Show hide the legend frame -->
    <script type="text/javascript">
        function toggleDiv(divId, divId1) {
            $("#" + divId).fadeToggle('slow');
        }
    </script>
        
        <div id="about" class="reveal-modal">
     		<a href="http://www.cartopolis.org"><img src="images/cartopolis_logo.png" width="50" alt="CartoPOLIS" style="float: right; margin: 50px 0 0 20px;" /></a>
            <h2>A propos des cartes de bruit</h2>
	<p>Les resultats présentés dans ce navigateurs sont issus des travaux de l'ANR Eval-PDU.</p>
            <p>Ces resultats proviennent de simulations réalisées avec la plateforme OrbisGIS. Les auteurs déclinent 
                toute responsabilité concernant l'interprétation qui pourrait en être faite.</p>
            <p>              
            <p>
                <strong>En savoir plus ?</strong> Visitez <a href="http://semfinalevalpdu.sciencesconf.org/" target="blank" title="Eval-PDU"><u>la page de synthèse du programme de recherche Eval-PDU</u>.</a></p>
     		<a class="close-reveal-modal">×</a>
	</div>
        <div class="reveal-modal-bg"></div>

 	
    </body>
</html>
